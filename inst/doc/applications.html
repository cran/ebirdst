<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>eBird Status Data Products Applications</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">eBird Status Data Products
Applications</h1>



<style type="text/css">
.table {
width: 50%;
}
</style>
<div id="load" class="section level1">
<h1>Loading raster data</h1>
<p>As covered in the <a href="https://ebird.github.io/ebirdst/articles/status.html">Introduction
to eBird Status Data Products vignette</a>, the function
<code>load_raster()</code> loads raster data products into R as
<code>SpatRaster</code> objects, which we can work with using the
<code>terra</code> package. Let’s start by loading the seasonal relative
abundance raster for the example Yellow-bellied Sapsucker data. We’ll
work with the low resolution (27 km) data in this vignette to ensure
fast processing times.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(ebirdst)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(geodata)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">library</span>(fields)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>extract <span class="ot">&lt;-</span> terra<span class="sc">::</span>extract</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co"># download the example yellow-bellied sapsucker data</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co"># this simplified dataset doesn&#39;t require an access key</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="fu">ebirdst_download_status</span>(<span class="st">&quot;yebsap-example&quot;</span>, <span class="at">download_ranges =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co"># load seasonal mean relative abundance at 27km resolution</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>abd_seasonal <span class="ot">&lt;-</span> <span class="fu">load_raster</span>(<span class="st">&quot;yebsap-example&quot;</span>, </span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>                            <span class="at">product =</span> <span class="st">&quot;abundance&quot;</span>, </span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>                            <span class="at">period =</span> <span class="st">&quot;seasonal&quot;</span>,</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>                            <span class="at">metric =</span> <span class="st">&quot;mean&quot;</span>,</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>                            <span class="at">resolution =</span> <span class="st">&quot;27km&quot;</span>)</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="co"># get the seasons corresponding to each layer</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="fu">names</span>(abd_seasonal)</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a><span class="co"># extract just the breeding season relative abundance</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>abd_breeding <span class="ot">&lt;-</span> abd_seasonal[[<span class="st">&quot;breeding&quot;</span>]]</span></code></pre></div>
<p>We can get the dates and quality scores associated with each of these
seasons by filtering the <code>ebirdst_runs</code> data frame.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>ebirdst_runs <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="co"># note that the example data are for yellow-bellied sapsucker</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="fu">filter</span>(species_code <span class="sc">==</span> <span class="st">&quot;yebsap-example&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code></pre></div>
</div>
<div id="map" class="section level1">
<h1>Mapping relative abundance</h1>
<p>In this section, we’ll demonstrate how to make a simple map of
breeding season relative abundance. However, note that to make
high-quality, publication-ready maps typically requires extra work. It
many cases, it may be worthwhile designing maps in a traditional GIS
environment such as QGIS or ArcGIS.</p>
<p>The simplest way to map the seasonal relative abundance data is to
use the built in <code>plot()</code> function from the
<code>terra</code> package.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">plot</span>(abd_breeding, <span class="at">axes =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Clearly this approach doesn’t work out of the box! There are a wide
variety of issues that we’ll tackle one at a time.</p>
<div id="extent" class="section level2">
<h2>Extent</h2>
<p>All raster data downloaded through this package are defined over the
same global grid, regardless of the range of the individual species. The
example data only has non-zero abundance within the state of Michigan,
which is barely visible on the above global map. We need to define an
extent for our map. There are a variety of ways to do this, but we’ll
use the R package <code>rnaturalearth</code> to access a polygon
boundary for Michigan, which we’ll then use to crop the raster.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># boundary polygon for michigan</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>mi <span class="ot">&lt;-</span> <span class="fu">ne_states</span>(<span class="at">iso_a2 =</span> <span class="st">&quot;US&quot;</span>, <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="fu">filter</span>(postal <span class="sc">==</span> <span class="st">&quot;MI&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="co"># project to same coordinate reference system as the raster data</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(abd_seasonal))</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co"># crop data to michigan</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>abd_breeding_mi <span class="ot">&lt;-</span> <span class="fu">crop</span>(abd_breeding, mi)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co"># map the cropped data</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="fu">plot</span>(abd_breeding_mi, <span class="at">axes =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="projection" class="section level2">
<h2>Projection</h2>
<p>The raster data are all provided in the same equal area sinusoidal
projection as NASA MODIS data. While this projection is suitable for
analysis, it is not ideal for mapping since it introduces significant
distortion. Instead, as part of the Status and Trends workflow, custom
species-specific projections are provided that are optimized for the
region that the species occurs within. We can access the projection for
Yellow-bellied Sapsucker with <code>load_fac_map_parameters()</code>,
then transform the raster data to this custom projection.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># load the mapping parameters</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>fac_parameters <span class="ot">&lt;-</span> <span class="fu">load_fac_map_parameters</span>(<span class="st">&quot;yebsap-example&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>crs <span class="ot">&lt;-</span> fac_parameters<span class="sc">$</span>custom_projection</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co"># transform to the custom projection using nearest neighbor resampling</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>abd_projected <span class="ot">&lt;-</span> <span class="fu">project</span>(abd_breeding_mi, crs, <span class="at">method =</span> <span class="st">&quot;near&quot;</span>)</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co"># map the cropped and projected data</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="fu">plot</span>(abd_projected, <span class="at">axes =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="abundance-bins" class="section level2">
<h2>Abundance bins</h2>
<p>The relative abundance data are not uniformly distributed, which can
lead to challenges distinguishing areas of differing levels of
abundance. To address this, we’ll use a quantile bins for the map, where
each color in the legend corresponds to an equal number of cells in the
raster. We’ll define these bins excluding zeros, then assign a separate
color to the zeros. We can also use the function
<code>abundance_palette()</code> to get the same set of colors we use in
the legends on the eBird Status and Trends website.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># quantiles of non-zero values</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">values</span>(abd_projected)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>v <span class="ot">&lt;-</span> v[<span class="sc">!</span><span class="fu">is.na</span>(v) <span class="sc">&amp;</span> v <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>bins <span class="ot">&lt;-</span> <span class="fu">quantile</span>(v, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>))</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co"># add a bin for 0</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>bins <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, bins)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co"># status and trends palette</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">ebirdst_palettes</span>(<span class="fu">length</span>(bins) <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co"># add a color for zero</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#e6e6e6&quot;</span>, pal)</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co"># map using the quantile bins</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="fu">plot</span>(abd_projected, <span class="at">breaks =</span> bins, <span class="at">col =</span> pal, <span class="at">axes =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="basemap" class="section level2">
<h2>Basemap</h2>
<p>Finally, we’ll add state and country boundaries to provide some
context. The R package <code>rnaturalearth</code> is an excellent source
of attribution free contextual GIS data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># natural earth boundaries</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>countries <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="fu">st_transform</span>(crs)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">ne_states</span>(<span class="at">iso_a2 =</span> <span class="st">&quot;US&quot;</span>, <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  <span class="fu">st_transform</span>(crs)</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co"># define the map extent with the michigan polygon</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>mi_ext <span class="ot">&lt;-</span> mi <span class="sc">%&gt;%</span> </span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>  <span class="fu">st_transform</span>(crs)</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="fu">plot</span>(mi_ext)</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co"># add basemap</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="fu">plot</span>(countries, <span class="at">col =</span> <span class="st">&quot;#cfcfcf&quot;</span>, <span class="at">border =</span> <span class="st">&quot;#888888&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co"># add data</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="fu">plot</span>(abd_projected, </span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>     <span class="at">breaks =</span> bins, <span class="at">col =</span> pal, </span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>     <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">legend =</span> <span class="cn">FALSE</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co"># add boundaries</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="fu">plot</span>(countries, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">&quot;#888888&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="fu">plot</span>(states, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">&quot;#888888&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="co"># add legend using the fields package</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="co"># label the bottom, middle, and top</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">quantile</span>(bins, <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>))</span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>label_breaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="fu">length</span>(bins))</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a><span class="fu">image.plot</span>(<span class="at">zlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> label_breaks, <span class="at">col =</span> pal,</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>           <span class="at">smallplot =</span> <span class="fu">c</span>(<span class="fl">0.90</span>, <span class="fl">0.93</span>, <span class="fl">0.15</span>, <span class="fl">0.85</span>),</span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>           <span class="at">legend.only =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a>           <span class="at">axis.args =</span> <span class="fu">list</span>(<span class="at">at =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), </span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a>                            <span class="at">labels =</span> <span class="fu">round</span>(labels, <span class="dv">2</span>),</span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>                            <span class="at">col.axis =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fg =</span> <span class="cn">NA</span>,</span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a>                            <span class="at">cex.axis =</span> <span class="fl">0.9</span>, <span class="at">lwd.ticks =</span> <span class="dv">0</span>,</span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a>                            <span class="at">line =</span> <span class="sc">-</span><span class="fl">0.5</span>))</span></code></pre></div>
</div>
</div>
<div id="trajectories" class="section level1">
<h1>Extracting trajectories with uncertainty</h1>
<p>Next, we’ll look at the temporal component of the relative abundance
data. Using the weekly relative abundance cubes, we can chart the change
in relative abundance throughout the year for a fixed location.
Furthermore, using the upper and lower confidence interval rasters, we
can add uncertainty estimates. We often refer to these as relative
abundance trajectories.</p>
<p>Let’s start by loading all the necessary relative abundance
cubes.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>abd_median <span class="ot">&lt;-</span> <span class="fu">load_raster</span>(<span class="st">&quot;yebsap-example&quot;</span>, <span class="at">product =</span> <span class="st">&quot;abundance&quot;</span>, </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>                          <span class="at">metric =</span> <span class="st">&quot;median&quot;</span>, <span class="at">resolution =</span> <span class="st">&quot;27km&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>abd_lower <span class="ot">&lt;-</span> <span class="fu">load_raster</span>(<span class="st">&quot;yebsap-example&quot;</span>, <span class="at">product =</span> <span class="st">&quot;abundance&quot;</span>,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>                         <span class="at">metric =</span> <span class="st">&quot;lower&quot;</span>, <span class="at">resolution =</span> <span class="st">&quot;27km&quot;</span>)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>abd_upper <span class="ot">&lt;-</span> <span class="fu">load_raster</span>(<span class="st">&quot;yebsap-example&quot;</span>, <span class="at">product =</span> <span class="st">&quot;abundance&quot;</span>, </span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>                         <span class="at">metric =</span> <span class="st">&quot;upper&quot;</span>, <span class="at">resolution =</span> <span class="st">&quot;27km&quot;</span>)</span></code></pre></div>
<p>Now we’ll extract the values for a fixed location.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># set a point</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>pt <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">88.1</span>, <span class="fl">46.7</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="fu">st_sfc</span>(<span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(abd_median)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="fu">st_coordinates</span>()</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co"># extract</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>traj_median <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">extract</span>(abd_median, pt))[<span class="dv">1</span>, ]</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>traj_upper <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">extract</span>(abd_upper, pt))[<span class="dv">1</span>, ]</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>traj_lower <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">extract</span>(abd_lower, pt))[<span class="dv">1</span>, ]</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co"># plot trajectories</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>plot_frame <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(traj_median)),</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>                         <span class="at">y =</span> <span class="fu">unname</span>(traj_median),</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>                         <span class="at">lower =</span> <span class="fu">unname</span>(traj_lower),</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>                         <span class="at">upper =</span> <span class="fu">unname</span>(traj_upper))</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="fu">ggplot</span>(plot_frame, <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> plot_frame) <span class="sc">+</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> plot_frame, </span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), </span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Relative abundance&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Week&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code></pre></div>
</div>
<div id="stats" class="section level1">
<h1>Regional statistics</h1>
<p>In addition to maps and visualizations, the eBird Status and Trends
website provides a set of statistics summarizing the spatial data over
regions (countries and states) and seasons. The five regional statistics
are:</p>
<ol style="list-style-type: decimal">
<li><strong>Mean relative abundance:</strong> the average estimated
relative abundance within the given region.</li>
<li><strong>Proportion of seasonal population:</strong> the sum of the
estimated relative abundance within the selected region divided by the
sum of the estimated relative abundance across the full range.</li>
<li><strong>Proportion of region occupied:</strong> the proportion of
the selected region within the range boundary of a species.</li>
<li><strong>Proportion of range in region:</strong> the proportion of a
species’ total range that falls within the selected region.</li>
<li><strong>Days of occupation in region:</strong> the number of days
that a species occupies the selected region, with occupation being
defined as spatially covering the selected region by at least 5% based
on estimated relative abundances averaged across the given season.</li>
</ol>
<p>These statistics can be downloaded from the Status and Trends website
for all regions and seasons for any given species; however, there may be
situations where you want to calculate them over different regions than
those provided. With that in mind, in this section we’ll cover how to
calculate a couple of these statistics: percent of population in region
and percent of region occupied. The remaining 3 statistics can be
calculated following the same approach with some modifications.</p>
<p>Since the example data used in this vignette is restricted to
Michigan, we’ll calculate the statistics over the counties in Michigan;
however, this approach can easily be extended to any set of regions.
Let’s start by downloading county boundaries for Michigan.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>mi_counties <span class="ot">&lt;-</span> <span class="fu">gadm</span>(<span class="at">country =</span> <span class="st">&quot;USA&quot;</span>, <span class="at">level =</span> <span class="dv">2</span>, <span class="at">path =</span> <span class="fu">tempdir</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="fu">filter</span>(NAME_1 <span class="sc">==</span> <span class="st">&quot;Michigan&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">county =</span> NAME_2, <span class="at">county_code =</span> HASC_2) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="co"># remove lakes which aren&#39;t true counties</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="fu">filter</span>(county_code <span class="sc">!=</span> <span class="st">&quot;US.MI.WB&quot;</span>)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co"># project to sinusoidal</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>mi_counties_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(mi_counties, <span class="at">crs =</span> <span class="fu">st_crs</span>(abd_median))</span></code></pre></div>
<p>We’ll need the seasonal proportion of population cubes and the
seasonal ranges for these calculations.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>pop_seasonal <span class="ot">&lt;-</span> <span class="fu">load_raster</span>(<span class="st">&quot;yebsap-example&quot;</span>, <span class="at">product =</span> <span class="st">&quot;proportion-population&quot;</span>, </span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>                            <span class="at">period =</span> <span class="st">&quot;seasonal&quot;</span>, <span class="at">resolution =</span> <span class="st">&quot;27km&quot;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>ranges <span class="ot">&lt;-</span> <span class="fu">load_ranges</span>(<span class="st">&quot;yebsap-example&quot;</span>, <span class="at">resolution =</span> <span class="st">&quot;27km&quot;</span>, <span class="at">smoothed =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div id="proportion-of-population" class="section level2">
<h2>Proportion of population</h2>
<p>Percent of population in regions is one of the simplest statistics to
calculate since a raster of percent of population is already provided;
we simply sum all the raster cells within each region polygon.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>prop_pop <span class="ot">&lt;-</span> <span class="fu">extract</span>(pop_seasonal, mi_counties_proj, <span class="at">fun =</span> sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="co"># attach county attributes</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">county_code =</span> mi_counties<span class="sc">$</span>county_code) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="co"># transpose to long format, one season per row</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>county_code, </span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;season&quot;</span>,</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;proportion_population&quot;</span>)</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="fu">head</span>(prop_pop)</span></code></pre></div>
<p>Let’s make a quick map comparing the breeding and non-breeding
proportion of population within counties in Michigan.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># join back to county boundaries</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>prop_pop_proj <span class="ot">&lt;-</span> prop_pop <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;breeding&quot;</span>, <span class="st">&quot;nonbreeding&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  <span class="fu">inner_join</span>(mi_counties, ., <span class="at">by =</span> <span class="st">&quot;county_code&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  <span class="co"># transform to custom projection for plotting</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> crs)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="fu">ggplot</span>(prop_pop_proj) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> proportion_population)) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">trans =</span> <span class="st">&quot;sqrt&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">barwidth =</span> <span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> season, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Seasonal proportion of population in MI counties&quot;</span>,</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Proportion of population&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
</div>
<div id="proportion-of-region-occupied" class="section level2">
<h2>Proportion of region occupied</h2>
<p>To calculate range-based stats it’s often easiest to use the range
polygons rather than the raster data. We can calculate the area of each
county, then calculate the area of intersection between the counties and
the ranges, and finally divide the two to get the proportion of each
region occupied.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># add the area of each region</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>mi_counties<span class="sc">$</span>area <span class="ot">&lt;-</span> <span class="fu">st_area</span>(mi_counties)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co"># for each season, intersect with the county boundaries and calculate area</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>range_pct_occupied <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> ranges<span class="sc">$</span>season) {</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  range_pct_occupied <span class="ot">&lt;-</span> ranges <span class="sc">%&gt;%</span> </span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>    <span class="fu">filter</span>(season <span class="sc">==</span> s) <span class="sc">%&gt;%</span> </span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>    <span class="fu">st_intersection</span>(mi_counties, .) <span class="sc">%&gt;%</span> </span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">proportion_occupied =</span> <span class="fu">as.numeric</span>(<span class="fu">st_area</span>(.) <span class="sc">/</span> area)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>    <span class="fu">select</span>(season, county_code, proportion_occupied) <span class="sc">%&gt;%</span> </span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>    <span class="fu">bind_rows</span>(range_pct_occupied, .)</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>}</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="fu">head</span>(range_pct_occupied)</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
